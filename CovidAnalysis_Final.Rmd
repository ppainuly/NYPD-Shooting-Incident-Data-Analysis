---
title: "Covid Analysis"
output:
  pdf_document: default
  word_document: default
date: "2022-08-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Aim

The aim of this markdown is to analyse Covid dataset from John Hopkins Repo [John Hopkins Covid Time Series Dataset](https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series)

The dataset captures daily time series summary tables, including confirmed, deaths and recovered. All data is read in from the daily case report. The time series tables are subject to be updated if inaccuracies are identified in our historical data.

Two time series tables are for the US confirmed cases and deaths, reported at the county level. They are named time_series_covid19_confirmed_US.csv, time_series_covid19_deaths_US.csv, respectively.

Three time series tables are for the global confirmed cases, recovered cases and deaths. Australia, Canada and China are reported at the province/state level. Dependencies of the Netherlands, the UK, France and Denmark are listed under the province/state level. The US and other countries are at the country level. The tables are renamed time_series_covid19_confirmed_global.csv and time_series_covid19_deaths_global.csv, and time_series_covid19_recovered_global.csv, respectively.

Publisher : John Hopkins Github [John Hopkins](https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series)

## Prepare for Analyses

Import Library

```{r }
set.seed(1234)
library(tidyverse)
library('lubridate')
library(ggplot2)
library(scales)
```

## Get URL

Copy the URL and Store into a variable so that it can be read as a csv:

```{r url_in, echo=TRUE}
url_in <- "https://github.com/CSSEGISandData/COVID-19/raw/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"

url_d <- "https://github.com/CSSEGISandData/COVID-19/raw/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv"
```

## Read Dataset from URL

Using read_csv function, store the dataset into a tibble

```{r read_csv(url_in)}
df_global_cases_r = read_csv(url_in)
df_global_death_r = read_csv(url_d)
```
## Tidy Data and Clean Up 

We will Rename the columns and pivot the date columns to prepare them for analysis as One date/Country per row. We will also convert all dates to yyyy-MM-dd format. We will also group the cases by date and country. Additionally, also create a dataframe to track worldwide cases by date(hence removing country). We will also track new cases for each day as a new column.

```{r}
df_global_cases <- df_global_cases_r %>%
  pivot_longer(-c('Province/State','Country/Region',Lat,Long),
                names_to = "date",
                values_to="confirmed_n") %>%
  select(-c(Lat,Long)) %>%
  rename(province_state = 'Province/State',
         country_region = 'Country/Region') %>% mutate(date=mdy(date)) %>%
  group_by(country_region, date) %>%
  summarise(confirmed_n = sum(confirmed_n)) %>%
  ungroup()

df_global_cases <- df_global_cases %>%
  arrange(date) %>%
  group_by(country_region) %>%
  mutate(new_cases = confirmed_n - lag(confirmed_n, default=0)) %>%
  ungroup()

df_world_cases = df_global_cases %>% group_by(date) %>%
          summarise(confirmed_n = sum(confirmed_n)) %>% 
  mutate(new_cases = confirmed_n - lag(confirmed_n, default=0)) %>% ungroup()


```
```{r}
df_global_death <- df_global_death_r %>%
  pivot_longer(-c('Province/State','Country/Region',Lat,Long),
                names_to = "date",
                values_to="confirmed_n") %>%
  select(-c(Lat,Long)) %>%
  rename(province_state = 'Province/State',
         country_region = 'Country/Region') %>% mutate(date=mdy(date)) %>%
  group_by(country_region, date) %>%
  summarise(confirmed_n = sum(confirmed_n)) %>%
  ungroup()

df_global_death <- df_global_death %>%
  arrange(date) %>%
  group_by(country_region) %>%
  mutate(new_cases = confirmed_n - lag(confirmed_n, default=0)) %>%
  ungroup()

df_world_death = df_global_death %>% group_by(date) %>%
          summarise(confirmed_n = sum(confirmed_n)) %>% 
  mutate(new_cases = confirmed_n - lag(confirmed_n, default=0)) %>% ungroup()


```

## Analysis

Overall, We have had close to 590 Million confirmed cases Worldwide as of 16th of August, 2022. 

```{r}
ggplot(df_world_cases,aes(x=date, y=confirmed_n/1000000)) + geom_line() +
  geom_line(aes(color = confirmed_n), size = 2) + 
  scale_colour_gradient(low = "gray", high = "#ff0000") + 
labs(title = "Confirmed Covid Cases Worldwide as of 08/16/2022",
       x = "Time Period",
       y = "Total Confirmed Cases in Millions")
```

Comparing the cumulative total number of cases worldwide, we can compare that to number of Total cases for the United States. The US has had more than 93 million cases so far(as of August 16th 2022). 

## United States accounts for 15.7% of Total Covid cases globally while having around 4.3 % of the global population.

```{r}
df_global_cases %>% filter(country_region == "US") %>%  ggplot(aes(x=date, y=confirmed_n/1000000)) + geom_line() +
  geom_line(aes(color = confirmed_n), size = 2) + 
  scale_colour_gradient(low = "gray", high = "#0072B2") + 
labs(title = "Confirmed Covid Cases for US as of 08/16/2022",
       x = "Time Period",
       y = "Total Confirmed Cases in Millions")
```

## New Cases Per day 

We can get the following trends from the chart below - 

1) The US reached 1 million cases in one day post 60 percent of population was fully vaccinated(Early 2022). This was post the Omicron wave had hit the US and the death rate was also at an all time high. This can be a bit tricy to understand but a lot of researchers have pointed out that people who were fully vaccinated had mild symptoms while the rest of the population which did not get the vaccine accounted for the majority of deaths. 

2) The high number of cases two years into the pandemic is interesting to look at. Especially because it is significantly higher than the first wave of 2020. It can be pointed out that covid "fatigue" had kicked in and people had moved on to live a life in a new normal way which meant increased population not using masks and decreased social distancing. No lock down and businesses opening up post 2021(early) also meant increased exposure.

3) Holiday period added to the increased number of cases. We see that post lockdown in 2020, it took untill end of 2020 with thanksgiving, christmas and inconsistent lockdown rules which led to a spike in cases. This spike drastically decreased early 2021 with the increased supply of vaccines. 

```{r}
df_global_cases %>% filter(country_region == "US") %>%  ggplot(aes(x=date, y=new_cases/1000000)) + geom_bar(colour="#0072B2", stat="identity") +
   # guides(fill=FALSE) +
  #geom_line(aes(color = confirmed_n), size = 1) + 
  #scale_colour_gradient(low = "gray", high = "#0072B2") + 
labs(title = "US Covid Timeline so Far",
       x = "Time Period",
       y = "New Cases per day (Millions)") + geom_hline(yintercept = 1) +
annotate("text", x=as.Date("2020-05-01"), y=1.03, label= "1 Million New Cases", size = 3.5) +
  geom_vline(xintercept=as.Date("2020-12-13"), linetype="dotted",colour="#37004D") + annotate("text", x=as.Date("2021-02-04"), y=1.15, label= "1st Vaccine \nDose",colour="#37004D",size=3)  +
  geom_vline(xintercept=as.Date("2021-05-20"), linetype="dotted",colour="red") + annotate("text", x=as.Date("2021-06-24"), y=1.15, label= "Delta \n Variant",colour="red",size=3.5) +
  geom_vline(xintercept=as.Date("2021-11-07"), linetype="dotted",colour="#CC00FFFF") + annotate("text", x=as.Date("2022-01-25"), y=1.45, label= "60% Vaccinated",colour="#CC00FFFF",size=3.5) +
  geom_vline(xintercept=as.Date("2020-03-15"), linetype="dotted",colour="#622828") + annotate("text", x=as.Date("2020-05-05"), y=0.45, label= "Lockdown",colour="#622828",size=3.5) 


```

## US Deaths Per Day

We see that the number of deaths significantly decreases after 1st dose of vaccine was rolled out. It started to increase by end of 2021/early 2022 which is also when the US hit 60 percent vaccinated population rate. Some scientists would explain that the proportion of population being hesitant against the vaccine or lack of vaccine availability in rural areas means the population not keen on getting the vaccine suffered fatalities(especially in the older population) during this time. Post that, the death rate remained far lower which could be because everyone who wanted the vaccine had received it, hence were protected against fatal virus effects.

```{r}
df_global_death %>% filter(country_region == "US") %>%  ggplot(aes(x=date, y=new_cases)) + geom_bar(colour="#FF6666", stat="identity") +
labs(title = "US Covid Deaths per day",
       x = "Time Period",
       y = "New Deaths per day ")  +
  geom_vline(xintercept=as.Date("2020-12-13"), linetype="dotted",colour="#277CD1") + annotate("text", x=as.Date("2021-02-24"), y=4600, label= "1st Vaccine Dose",colour="#277CD1",size=3)  +
  geom_vline(xintercept=as.Date("2021-05-20"), linetype="dotted",colour="red") + annotate("text", x=as.Date("2021-06-24"), y=4500, label= "Delta \n Variant",colour="red",size=3.5) +
  geom_vline(xintercept=as.Date("2021-11-07"), linetype="dotted",colour="#CC00FFFF") + annotate("text", x=as.Date("2022-01-25"), y=4500, label= "60% Vaccinated",colour="#CC00FFFF",size=3.5) +
  geom_vline(xintercept=as.Date("2020-03-15"), linetype="dotted",colour="#622828") + annotate("text", x=as.Date("2020-05-05"), y=4500, label= "Lockdown",colour="#622828",size=3.5) 
```

## Model : Is there a relationship between Month of the year and Number of Detected Cases for the State of New York?

We want to see if we detect more cases during summer or winter months. A lot of factors such as weather, tourism, economy, holidays would affect which season or month gets a larger share of covid cases from all counties/provinces.

```{r}
url_us_c <- "https://github.com/CSSEGISandData/COVID-19/raw/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"


us_c = read_csv(url_us_c)


us_c <- us_c %>% 
  pivot_longer(cols = -(UID:Combined_Key),
                      names_to = "date",
                      values_to = "cases") %>%
  select(Admin2:cases) %>%
  mutate(date = mdy(date)) %>%
  select(-c(Lat,Long_))
```

Wrangling US Cases Data to store the value of Month. We will not look at the cases for NY State and look into the relationship between Month of the year and Number of cases.

```{r}
#us_c$month <- format(us_c$date,format="%B")
#us_c$month2 <- format(us_c$date,format="%m")

us_c_ny = filter(us_c, Province_State == "New York")
us_c_ny$month2 <- format(us_c_ny$date,format="%m")

```

```{r}

mod = lm(cases ~ month2, data=us_c_ny)
plot(us_c_ny$month2, us_c_ny$cases,type = "p", col="blue", bg="lightblue",pch = 10, cex = 1.3,main = "# of Cases in NY State per each month",
     xlab = "Month# of the Year",
     ylab = "Number of Cases for each Day") + abline(mod, col="red")

```

```{r}
summary(mod)
```

## Explanation of the Model

Looking at the p-value i.e < 2.2e-16, we can say that our hypothesis is statistically significant. There is a relationship between month of the year and increase in Number of covid cases detected. The chart above shows a high number of cases for Early parts of the year i.e Jan. The cases then decline towards the Spring before increasing in the summer. People tend to be outdoors during the summer and tourism also increases across NY State during early summer and Autumn. We see the highest number of cases reported during the month of August which is when NY State has mild weather. We also observe a greater difference between the upper limit and mid limit of cases for August. This could be explained that New York City gets a significantly larger number of cases than other provinces. The month of December, we see the number of cases drop since people stay indoors and tourism decreases.

## Conclusion 

We can see that a variety of factors such as vaccine rollout, month of the year, lockdown rules and population density played a big role in different spikes of cases and deaths around the United States and New York State. Each spike in cases was exponentially greater than the previous spike, however for the death data, that was not the case. We did see that December and early Jan accounted for a majority of cases and deaths which could be due to the perfect storm of holidays, people staying indoors, increased tourism and people wanting to get back to normal after staying vigilant all throughout the year(for 2020 and 2021).

## Bias

I want to address the bias in the data that rural areas have been overlooked due to lower population density. There is a feeling that rural areas have a lower number of vaccinated population, and are not as accepting to the lockdown and vaccine recommendations. But we cant look at this from a universal lens and have to look at rural areas case by case basis depending on location and other socio-polital factors. 

Another source of Bias is that I thought that once we reach a higher number of vaccinated population, Covid cases and death would be under control but the spike of late 2021/early 2022 proved otherwise which tells us that this is more about which state and how is the population distributed rather than just looking at the total population since the US is a big country where half the population lives in Big cities.